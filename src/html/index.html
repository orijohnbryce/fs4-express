<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WS</title>
    
</head>

<body>
    <h1 style="background-color: red;"> Chat with BE using WS !!! </h1>

    <button onclick="connect()"> Connect </button>
    <button onclick="disconnect()"> Disconnect </button>

    <br />
    <br />

    <input id="msgInput" placeholder="Enter message" />
    <button onclick="sendMsg()"> Send </button>
    <button onclick="sendSmile()"> Smile </button>

    <div id="msgs"></div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <script>
        let socket;
        const msgsDiv = document.getElementById("msgs");

        function connect(params) {
            if (socket) {
                alert("Socket already connected");
                return;
            }
            socket = io("http://localhost:4000");

            socket.on("server-msg", (msg) => {
                msgsDiv.innerHTML += `<p> ${msg} </p>`;
            })
            document.querySelector("h1").style.backgroundColor = "green"
        }

        function disconnect() {
            socket?.disconnect();
            socket = null;
            document.querySelector("h1").style.backgroundColor = "red"
        }

        function sendMsg() {
            if (!socket) {
                alert("Socket not connected!")
                return;
            }
            const msg = document.querySelector("#msgInput").value;

            msgsDiv.innerHTML += `<p> ${msg} </p>`;

            socket.emit("new-msg", msg);

            document.querySelector("#msgInput").value = "";
        }

        function sendSmile() {
            socket?.emit("smile", "")
        }
    </script>
</body>

</html>